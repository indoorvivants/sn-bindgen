<html><head><title>SN bindgen: Cookbook</title><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/styles/tomorrow-night-blue.min.css" /><script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script><script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/languages/scala.min.js"></script><script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/languages/c.min.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" href="/assets/styles.css" /><link rel="stylesheet" href="/assets/tailwind.css" /><script src="/assets/search.js" defer="defer"></script><script src="/assets/search-index.js" defer="defer"></script><link rel="stylesheet" href="/assets/subatomic-search.css" /><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /></head><body onclick="SubatomicSearchFrontend.sayHello()" class="bg-gradient-to-r from-emerald-800 to-sky-700 mt-4 w-full"><header class="flex m-2 mb-4 md:m-auto md:w-11/12 lg:max-w-7xl flex-col md:flex-row md:items-center justify-between mb-2"><div><a class="block text-6xl text-white" href="/">SN bindgen</a><p class="text-white">Scala 3 Native binding generator to C libraries</p></div><div id="searchContainer"></div><div class="site-links"><a href="https://github.com/indoorvivants/sn-bindgen"><img class="w-12 opacity-70 hover:opacity-100" src="https://cdn.svgporn.com/logos/github-icon.svg" /></a></div></header><main class="rounded-xl bg-white m-2 mb-4 md:m-auto md:w-11/12 lg:max-w-7xl p-4 flex flex-col-reverse md:flex-row gap-6"><aside class="lg:w-64 shrink-1 lg:shrink-0 grow-0 md:border-r-2 max-w-[300px] border-slate-200 pr-2"><ul class="text-2xl p-4 block"><li><a class="" href="/index.html">Home</a><ul class="text-xl p-2 block"></ul></li><li><a class="" href="/semantics/index.html">Semantics </a><ul class="text-xl p-2 block"></ul></li><li><a class="" href="/configuration/index.html">Configuration </a><ul class="text-xl p-2 block"></ul></li><li><a class="" href="/limitations/index.html">Limitations</a><ul class="text-xl p-2 block"></ul></li><li><a class="" href="/exports/index.html">Exports </a><ul class="text-xl p-2 block"></ul></li><li><a class="" href="/motivation/index.html">Motivation</a><ul class="text-xl p-2 block"></ul></li><li><a class="" href="/quickstart/index.html">Quick start</a><ul class="text-xl p-2 block"></ul></li><li><a class="font-bold" href="/cookbook/index.html">Cookbook</a><ul class="text-xl p-2 block"></ul></li></ul></aside><article class="grow-4 lg:max-w-6xl markdown"><div class="float-right p-3 rounded-md border-2 border-sky-700 max-w-12 m-4"><ul class="list-disc my-0 mx-2 text-sm"><li><a class="underline hover:no-underline text-sky-700 text-base" href="#generating-bindings-from-multiple-header-files">Generating bindings from multiple header files</a></li><li><a class="underline hover:no-underline text-sky-700 text-base" href="#rendering-the-binding-as-multiple-files">Rendering the binding as multiple files</a></li><li><a class="underline hover:no-underline text-sky-700 text-base" href="#advanced-splitting-the-binding-into-multiple-packages">(advanced) Splitting the binding into multiple packages</a><ul class="list-disc my-0 mx-2 text-sm"><li><a class="underline hover:no-underline text-sky-700 text-base" href="#by-definition-header-file-location">By definition header file location</a></li><li><a class="underline hover:no-underline text-sky-700 text-base" href="#by-definition-name">By definition name</a></li></ul></li></ul></div><div><h2><a href="#generating-bindings-from-multiple-header-files" id="generating-bindings-from-multiple-header-files">Generating bindings from multiple header files</a></h2>
<p>Some libraries break apart their functionality among several header files, that you are supposed to pick and choose.</p>
<p>The tools provided by clang to figure out which definition came from which file are quite crude, and the logic
to merge results would be quite complex to be attempted.</p>
<p>You can use the amalgam pattern, by pointing the binding generator not at a file in the library, but your own header file that includes them.</p>
<p>For example, with OpenSSL, I would write a <code>openssl-amalgam.h</code>:</p>
<pre><code class="language-c">#include &quot;openssl/sha.h&quot;
#include &quot;openssl/evp.h&quot;
</code></pre>
<p>And point the binding generator at it:</p>
<pre><code class="language-scala">bindgenBindings += {
    Binding
      .builder(
        (Compile / baseDirectory).value / &quot;openssl-amalgam.h&quot;,
        &quot;openssl&quot;
      )
      .withCImports(List(&quot;openssl/sha.h&quot;, &quot;openssl/evp.h&quot;))
      .withClangFlags(List(&quot;-I&quot; + vcpkgConfigurator.value.includes(&quot;openssl&quot;)))
      .build
}
</code></pre>
<p>Example taken from <a href="https://github.com/indoorvivants/sn-bindgen-examples/blob/82c109aac423c1adacaf1a2a1458d6d0afdea7b6/build.sbt#L374">sn-bindgen-examples</a></p>
<h2><a href="#rendering-the-binding-as-multiple-files" id="rendering-the-binding-as-multiple-files">Rendering the binding as multiple files</a></h2>
<p>In case of really big bindings (think Glib from Gnome), a single file may be unwieldy and take a very long time
to compile.</p>
<p>You can help the situation by using the multi-file mode - where the bindgen will treat <code>--out</code> parameter
as a folder and create several files there with definitions broken down by type.</p>
<ul>
<li>To enable multi-file mode in CLI, use <code>--multi-file</code> parameter.</li>
<li>To enable multi-file mode in SBT, use <code>multiFile = true</code> in Binding specification.</li>
</ul>
<h2><a href="#advanced-splitting-the-binding-into-multiple-packages" id="advanced-splitting-the-binding-into-multiple-packages">(advanced) Splitting the binding into multiple packages</a></h2>
<p><em>Note: this technique is annoyingly manual, prone to errors and should only be used if rendering the binding as a single entity breaks the compiler</em></p>
<p>This option was heavily inspired by Gtk bindings, which are actually comprised of:</p>
<ol>
<li>Glib, which itself consists of
<ul>
<li>Glib itself</li>
<li>GIO</li>
<li>GObject</li>
</ul>
</li>
<li>Pango (which depends on Glib)</li>
<li>Cairo</li>
<li>Harfbuzz</li>
<li>etc.</li>
</ol>
<p>Because of how includes in C work, you get <em>all</em> of those libraries bundled in the binding, which can be very annoying and difficult for compiler to work with.</p>
<p>To work around it, we can build bindings to constituent libraries separately, and then,
when building the Gtk bindings, tell the generator to not render Pango, Cairo, etc. definitions again, but rather assume that they will come from a certain package.</p>
<p>We can indicate this binding splitting in two ways - by header file location, or by definition name.</p>
<h3><a href="#by-definition-header-file-location" id="by-definition-header-file-location">By definition header file location</a></h3>
<p>In the CLI: <code>--render.external-path */glib-2.0/*=glib</code></p>
<p>In the Binding builder: <code>.withExternalPaths(Map(&quot;*/glib-2.0/*&quot; -&gt; &quot;glib&quot;))</code></p>
<p>This will ensure that for all definitions that are defined in header files that match <code>*/glib-2.0/*</code> glob, they will be rendered as references in package <code>glib</code> instead.</p>
<h3><a href="#by-definition-name" id="by-definition-name">By definition name</a></h3>
<p>In the CLI: <code>--render.external-name Gtk*=gtk</code></p>
<p>In the Binding builder: <code>.withExternalNames(Map(&quot;Gtk*&quot; -&gt; &quot;gtk&quot;))</code></p>
<p>This will ensure that all definitions that whose name matches <code>Gtk*</code> will be rendered as references in package <code>gtk</code> instead.</p>
</div></article></main><footer class="text-center m-4 p-4 text-lg text-white font-bold m-auto w-full">Â© 2021-2024 Anton Sviridov</footer><script src="https://www.googletagmanager.com/gtag/js?id=G-2V7BY56Z37"></script><script> window.dataLayer = window.dataLayer || [];
              function gtag(){window.dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'G-2V7BY56Z37');</script></body></html>